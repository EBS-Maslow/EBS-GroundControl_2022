#:kivy 2.0.0

#<Widget>:
#This can be used to create boxes around each widget to clarify positioning issues. It is only for debug
#    canvas.after:
#        Line:
#            rectangle: self.x+1,self.y+1,self.width-1,self.height-1
#            dash_offset: 5
#            dash_length: 3
#:import Factory kivy.factory.Factory

<MySpinnerOption@SpinnerOption>:
    background_color: (.35, .35, .35, 1) if self.state == 'down' else (0, 1, 2.2, 1)
    background_down: 'atlas://data/images/defaulttheme/button'
    color: (9, 9, 9, 1)

<ButtonTemplate>:
    GridLayout:
        cols: 1
        size: root.size
        pos: root.pos
        Button:
            border: (2, 2, 2, 2)
            background_normal: root.btnBackground      # The background when the button is not pressed
            background_down:   root.btnBackgroundDown  # The background when the button is pressed
            on_press: root.internal_on_press()
            on_release: root.internal_on_release()
            Label:
                text: '[color=ffffff]' + root.text + '[/color]'
                markup: True
                pos: (root.pos[0] + (root.width - self.width)/2, root.pos[1] + (root.height-self.height)/2)

<ButtonControls>:
    GridLayout:
        cols: 1
        size: root.size
        pos: root.pos
        Button:
            border: (2, 2, 2, 2)
            background_normal: root.btnBack
            background_down:   root.btnBackDown  
            on_press: root.internal_on_press()
            on_release: root.internal_on_release()

<ScreenControls>:
    actionsBtn:actionsBtn
    settingsBtn:settingsBtn

    BoxLayout:
        orientation: 'horizontal'
        pos: (0, root.height - dp(60))
        size_hint: (None,None)
        width: dp(400)
        height: dp(60)
        padding: 10
        ButtonTemplate:
            text: ""
            funcToCallOnRelease: root.show_actions
            id: actionsBtn
        ButtonTemplate:
            text: ""
            funcToCallOnRelease: root.openSettings
            id: settingsBtn

<GcodeCanvas>:
    scatterObject:scatterObject
    scatterInstance:scatterInstance
    positionIndicator:positionIndicator
    targetIndicator:targetIndicator

    ScatterPlane:
        do_rotation: False
        id: scatterInstance
        Label:
            id: scatterObject
            text: ""
        PositionIndicator:
            id: positionIndicator
        PositionIndicator:
            id: targetIndicator
        MenuSpawner:
            timeout: 1
            menu_args:
                dict(
                creation_direction=1,
                radius=30,
                creation_timeout=.2,
                choices=[
                dict(text='[color=ffffff]Move Sled Here[/color]', markup = True, font_size=30, index=1),
                dict(text='Position Text Placeholder'      , markup = True, font_size=30, index=2),
                dict(text='[color=ffffff]Set Home[/color]' , markup = True, font_size=30, index=3),
                dict(text='[color=ffffff]Mark Here[/color]', markup = True, font_size=30, index=4)])

<FrontPage>:
    textconsole:textconsole
    moveDistInput:moveDistInput
    moveSpeedInput:moveSpeedInput
    gcodecanvas:gcodecanvas
    screenControls:screenControls
    holdBtn:holdBtn
    macro1Btn:macro1Btn
    macro2Btn:macro2Btn

    upLeftArrow:upLeftArrow
    upArrow:upArrow
    upRightArrow:upRightArrow
    leftArrow:leftArrow
    homeBtn:homeBtn
    rightArrow:rightArrow
    downLeftArrow:downLeftArrow
    downArrow:downArrow
    downRightArrow:downRightArrow

    zAxisBtn:zAxisBtn
    unitsBtn:unitsBtn
    defHomeBtn:defHomeBtn
    zLeft:zLeft
    zRight:zRight
    oneLeft:oneLeft
    oneRight:oneRight

    run:run
    stopBtn:stopBtn
    goTo:goTo
    dCommand:dCommand

    GcodeCanvas:
        id: gcodecanvas
        cols: 2
    BoxLayout:
        orientation: 'vertical'
        pos: root.width - dp(310), dp(10)
        GridLayout:
            canvas.before:
                Color:
                    rgba: .32, .32, .32, 1
                Rectangle:
                    pos:self.pos
                    size:self.size
            cols: 4
            #padding: 10, 10
            size_hint: None, None
            width:dp(300)
            height: dp(60*4)
            #disabled: not app.data.connectionStatus
            ButtonTemplate:
                id: upLeftArrow
                funcToCallOnPress: root.upLeft
            ButtonTemplate:
                id: upArrow
                funcToCallOnPress: root.up
            ButtonTemplate:
                id: upRightArrow
                funcToCallOnPress: root.upRight
            ButtonTemplate:
                id: macro1Btn
                text: "Macro 1"
                funcToCallOnPress: lambda:root.macro(1)
            ButtonTemplate:
                id: leftArrow
                funcToCallOnPress: root.left
            ButtonTemplate:
                id: homeBtn
                funcToCallOnPress: root.home
            ButtonTemplate:
                id: rightArrow
                funcToCallOnPress: root.right
            ButtonTemplate:
                id: macro2Btn
                text: "Macro 2"
                funcToCallOnPress: lambda:root.macro(2)
            ButtonTemplate:
                id: downLeftArrow
                funcToCallOnPress: root.downLeft
            ButtonTemplate:
                id: downArrow
                funcToCallOnPress: root.down
            ButtonTemplate:
                id: downRightArrow
                funcToCallOnPress: root.downRight
            ButtonTemplate:
                id: zAxisBtn
                disabled: app.data.uploadFlag == 1
                text: 'Z-Axis'
                funcToCallOnPress: root.zAxisPopup
            Label:
                id: moveSpeedInput
                color: 1, 1, 1, 1
                text: 'Dist To \nMove:'
                multiline: False
            ButtonTemplate:
                id: moveDistInput
                text: '100'
                multiline: False
                funcToCallOnPress: lambda:root.textInputPopup(self)
            ButtonTemplate:
                text: root.units
                funcToCallOnPress: root.switchUnits
                id: unitsBtn
            ButtonTemplate:
                text: 'Define\nHome'
                funcToCallOnPress: root.moveOrigin
                id: defHomeBtn

        GridLayout:
            canvas.before:
                Color:
                    rgba: .1, .1, .1, 1
                Rectangle:
                    pos:self.pos
                    size:self.size
            cols: 3
            #padding: 10, 0
            size_hint: None, None
            width: dp(300)
            height: dp(60)
            #disabled: not app.data.connectionStatus
            ButtonControls:
                id: run
                funcToCallOnPress: root.startRun
            ButtonControls:
                id: holdBtn
                secretText: "HOLD"
                funcToCallOnPress: root.pause
            ButtonControls:
                id: stopBtn
                funcToCallOnPress: root.stopRun
        GridLayout:
            canvas.before:
                Color:
                    rgba: .1, .1, .1, 1
                Rectangle:
                    pos:self.pos
                    size:self.size
            cols: 5
            #padding: 10, 0
            size_hint: None, None
            width: dp(300)
            height: dp(30)
            #disabled: not app.data.connectionStatus
            ButtonTemplate:
                text: "<Z"
                funcToCallOnPress: lambda:root.moveGcodeZ(-1)
                id: zLeft
            ButtonTemplate:
                text: "<1"
                funcToCallOnPress: lambda:root.moveGcodeIndex(-1)
                id: oneLeft
            ButtonTemplate:
                id: goTo
                text: 'GoTo'
                funcToCallOnPress: root.gotoLinePopup
            ButtonTemplate:
                text: "1>"
                funcToCallOnPress: lambda:root.moveGcodeIndex(1)
                id: oneRight
            ButtonTemplate:
                text: "Z>"
                funcToCallOnPress: lambda:root.moveGcodeZ(1)
                id: zRight
        GridLayout:
            cols: 2
            size_hint: None, None
            width: dp(300)
            height: dp(30)
            TextInput:
                id: dCommand
                text:''
                hint_text: 'Direct commands'
                background_color: 1, 1, 1, .8
                size_hint_x: 70
                multiline: False
                on_text_validate: root.directCommand()
            Button:
                text: "Send"
                background_normal: "./images/icons/normal/definehome.png"
                size_hint_x: 30
                on_release: root.directCommand()
        BoxLayout:
            canvas.before:
                Color:
                    rgba: .0, .0, .0, 1
                Rectangle:
                    pos:self.pos
                    size:self.size
            orentation: 'horizontal'
            size_hint: None, None
            width: dp(300)
            height: dp(70)
            #disabled: not app.data.connectionStatus
            GridLayout:
                cols: 2
                Label:
                    text: '                   X : '
                    color: (1, 1, 1, 1)
                Label:
                    text: root.xReadoutPos
                    color: (1, 1, 1, 1)
                Label:
                    text: '                   Y : '
                    color: (1, 1, 1, 1)
                Label:
                    text: root.yReadoutPos
                    color: (1, 1, 1, 1)
                Label:
                    text: '                   Z : '
                    color: (1, 1, 1, 1)
                Label:
                    text: root.zReadoutPos
                    color: (1, 1, 1, 1)
                Label:
                    text: '                 Vel : '
                    color: (1, 1, 1, 1)
                Label:
                    text: root.ReadoutVel
                    color: (1, 1, 1, 1)
            GridLayout:
                cols: 1
                Label:
                    text: "Percent Complete:"
                    font_size: '11sp'
                    color: (1, 1, 1, 1)
                Label:
                    text: root.percentComplete
                    color: (1, 1, 1, 1)
                Label:
                    text: "G-code Line:"
                    font_size: '11sp'
                    color: (1, 1, 1, 1)   
                Label:
                    text: root.gcodeLineNumber
                    color: (1, 1, 1, 1)
                Label:
                    text: root.gcodeVel
                    color: (1, 1, 1, 1)
        Label:
            canvas.before:
                Color:
                    rgba: (.6, .0, .0, 1) if root.connectionStatus !='Connected' else (.05, .65, .0, 1)
                Rectangle:
                    pos:self.pos
                    size:self.size
            text: root.connectionStatus
            size_hint: None, None
            width: dp(300)
            height: dp(30)
            disabled: False
            color: (1, 1, 1, 1)        
        GridLayout:
            canvas.before:
                Color:
                    rgba: (.32, .32, .32, 1)
                Rectangle:
                    pos:self.pos
                    size:self.size
            cols: 3
            size_hint: None, None
            size: dp(300), root.height - dp(475)
            BoxLayout:
                size_hint_x: 3
            ScrollableLabel:
                id: textconsole
                text: root.consoleText
                size_hint_x: 97
            BoxLayout:
                size_hint_x: 0    
    BoxLayout:
        orientation: 'vertical'
        pos: root.width - dp(10), dp(0)

    ScreenControls:
        id: screenControls
        size_hint: (1, 1)

<ViewMenu>:
    cols:1
    size: root.size
    pos: root.pos
    Label:
        text: ""
        color: (0, 0, 0, 1)
    Button:
        text: 'Open Gcode File'
        on_press: root.openFile()
        disabled: app.data.uploadFlag == 1
    Button:
        text: 'Update Gcode'
        on_release: root.reloadGcode()
        disabled: app.data.uploadFlag == 1
    Button:
        text: 'View Gcode'
        disabled: False
        on_press: root.show_gcode()
    Button:
        text: 'Clear Gcode'
        disabled: False
        on_press: root.clear_gcode()
    Button:
        text: 'Reset View'
        disabled: False
        on_press: app.frontpage.gcodecanvas.centerCanvas()
        on_release: root.resetView()

<RunMenu>:
    GridLayout:
        cols: 1
        size_hint_y:1.04
        size: root.size
        pos: root.pos
        Label:
            text: "Run"
        Button:
            text: 'Quit Ground Control'
            on_release: root.closeGC()
        Button:
            text: 'Return To Center'
            on_release: root.returnToCenter()
            #disabled: not app.data.connectionStatus
        Button:
            text: 'Zero Z'
            disabled: True
        Button:
            text: 'Auto Zero Z'
            disabled: True

<ScrollableLabel>:
    Label:
        size_hint_y: None
        height: self.texture_size[1]
        text_size: self.width, None
        text: root.text
        color: (0, 0, 0, 1)
<ConnectMenu>:
    GridLayout:
        cols: 1
        size_hint_y:1.25
        size: root.size
        pos: root.pos
        Label:
            text: ""
            color: (0, 0, 0, 1)
        Spinner:
            id: ports
            text: "Connect to machine"
            values: root.COMports
            on_text: root.setPort(ports.text)
            option_cls: Factory.get("MySpinnerOption")
        Button:
            text: 'Update ports'
            on_press: root.updatePorts()

<Diagnostics>:
    GridLayout:
        rows: 2
        size: root.size
        pos: root.pos
        Label:
            text: "Calibration and Testing"
            color: (0, 0, 0, 1)
        GridLayout:
            cols: 2
            #disabled: not app.data.connectionStatus
            Button:
                text: 'Calibrate'
                on_release: root.calibrateMachine()
            Button:
                text: 'Test Motors/Encoders'
                on_press: root.testMotors()
            Spinner:
                id: advancedOptions
                text: "Advanced"
                values: ["Set Chain Length - Manual", "Wipe EEPROM", "Simulation", "Factory Reset"]
                on_text: root.advancedOptionsFunctions(advancedOptions.text)
                option_cls: Factory.get("MySpinnerOption")
            Button:
                text: 'About'
                on_release: root.about()


<OtherFeatures>:
    connectmenu:connectmenu
    viewmenu:viewmenu
    diagnostics:diagnostics
    #runmenu:runmenu

    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            orientation: 'horizontal'
            padding:2
            spacing:0
            ViewMenu:
                id: viewmenu
            #RunMenu:
                #id: runmenu
            ConnectMenu:
                id: connectmenu
        BoxLayout:
            orientation: 'vertical'
            padding:2
            spacing:0

            Diagnostics:
                id: diagnostics
            Button:
                text: "Close"
                size_hint_y: .25
                on_release: root.close()

<SoftwareSettings>:

<PositionIndicator>:
    size: 50, 50
    canvas:
        Color:
            rgb: root.color
        Line:
            circle:
                (self.center_x-self.width/2, self.center_y-self.height/2, min(self.width, self.height)/ 2)
        Line:
            circle:
                (self.center_x-self.width/2, self.center_y-self.height/2, self.positionErrorRadius)
        Line:
            circle:
                (self.center_x-self.width/2, self.center_y-self.height/2, .5)
        Line:
            points: (self.x-self.width/2, self.y-self.height/2, self.width/2+self.x, self.height/2+self.y)
        Line:
            points: (self.x-self.width/2, self.height/2+self.y, self.width/2+self.x, self.y-self.height/2)

<NotificationPopup>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"

        ScrollableLabel:
            text: root.text
        BoxLayout:
            size_hint_y: None
            height: dp(60)
            Button:
                text: "Continue"
                background_color: (0, 1, 0, .8)
                on_release: root.continueOn()

<ScrollableTextPopup>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"

        ScrollableLabel:
            text: root.text

       # BoxLayout:
       #     size_hint_y: None
       #     height: dp(60)
       #     Button:
       #         text: "Close"
       #         on_release: root.cancel()

<PageableTextPopup>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        ScrollableLabel:
            text: root.text

        BoxLayout:
            size_hint_y: None
            height: dp(30)
            Button:
                text: "Prev"
                on_release: root.prev()
            Button:
                text: "Next"
                on_release: root.next()
            Button:
                text: "Close"
                on_release: root.cancel()

<SaveDialog>:
    text_input: text_input
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            on_selection: text_input.text = self.selection and self.selection[0] or ''

        TextInput:
            id: text_input
            size_hint_y: None
            height: dp(30)
            multiline: False

        BoxLayout:
            size_hint_y: None
            height: dp(30)
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Save"
                on_release: root.save(filechooser.path, text_input.text)

<TouchNumberInput>:
    textInput:textInput
    unitsBtn:unitsBtn
    cols: 1
    size: root.size
    pos: root.pos
    GridLayout:
        cols: 2
        size_hint_y:.25
        TextInput:
            size_hint_x:.8
            font_size: self.height - 9
            padding: 0,0,5,0
            id:textInput
            disabled: True
        Button:
            size_hint_x: .1
            text: 'MM'
            background_color: (0,0,0,0)
            id: unitsBtn
            on_release: root.switchUnits()
    GridLayout:
        cols: 3
        Button:
            text: "1"
            on_release: root.addText("1")
        Button:
            text: "2"
            on_release: root.addText("2")
        Button:
            text: "3"
            on_release: root.addText("3")
        Button:
            text: "4"
            on_release: root.addText("4")
        Button:
            text: "5"
            on_release: root.addText("5")
        Button:
            text: "6"
            on_release: root.addText("6")
        Button:
            text: "7"
            on_release: root.addText("7")
        Button:
            text: "8"
            on_release: root.addText("8")
        Button:
            text: "9"
            on_release: root.addText("9")
        Button:
            text: "."
            on_release: root.addText(".")
        Button:
            text: "0"
            on_release: root.addText("0")
        Button:
            text: "Done"
            on_release: root.done()

<ZAxisPopupContent>:
    distBtn:distBtn
    unitsBtn:unitsBtn
    cols: 1
    size: root.size
    pos: root.pos
    GridLayout:
        cols: 2
        GridLayout:
            size_hint_x: ".75sp"
            cols: 5
            rows: 4
            Label:
                text: ""
                size_hint_y: 0.2
            Label:
                size_hint_y: 0.2
            Label:
                text: "Relative"
                size_hint_y: 0.2
            Label:
                text: "Absolute"
                size_hint_y: 0.2
            Label:
                text: ""
                size_hint_y: 0.2
            GridLayout:
                cols:1
                rows:2
                Button:
                    text: "%.3f"%app.data.zStepSizeVal
                    id: distBtn
                    on_release: root.setDist()
                Button:
                    text: "MM"
                    on_release: root.units()
                    id: unitsBtn
            GridLayout:
                cols: 1
                rows: 2
                Button:
                    text: "Set Top\nLimit"
                    halign: "center"
                    on_release: root.zUpperLimit()
                Button:
                    text: "Set Bottom\nLimit"
                    halign: "center"
                    on_release: root.zLowerLimit()
            Button:
                text: "Raise"
                on_release: root.zOut()
            GridLayout:
                cols:1
                rows:2
                Button:
                    text: "Plunge to\n-"+root.distBtn.text
                    halign: "center"
                    on_release: root.goThere()
                Button:
                    text: "Save and\nRaise to\nTraverse"
                    halign: "center"
                    on_release: root.zUp()

            Button:
                text: "Stop!"
                # font_size: '48sp'
                background_color: (2.5, 0.5, 1.0, 0.7)
                on_release: root.stopZMove()
            Button:
                text: "Define Zero"
                on_release: root.zero()
            GridLayout:
                cols: 1
                rows: 2
                Button:
                    text: "Clear soft\n Limits"
                    halign: "center"
                    on_release: root.zClearLimit()
                Button:
                    text: "Probe\nTouch Zero"
                    halign: "center"
                    on_release: root.touchZero()
                    disabled: False
            Button:
                text: "Lower"
                on_release: root.zIn()
            GridLayout:
                cols:1
                rows:2
                Button:
                    text: "Go to Zero"
                    on_release: root.zToZero()
                Button:
                    text: root.zCutLabel
                    halign: "center"
                    disabled: root.zPopDisable
                    on_release: root.zToCut()
            Button:
                text: "Done"
                # font_size: '48sp'
                on_release: root.close()

#calibration widgets

<CalibrationTemplate>:
    cols: 2
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        size_hint_x: leftCol
        Label:
            text: "Text about what to do in this step"
            size_hint_x: leftCol
        GridLayout:
            cols: 2
            Image:
                source: "./images/setzheight.jpg"
    GridLayout:
        cols: 1
        size_hint_x: rightCol
        Label:
        Button:
            text: "Thing one"
        Button:
            text: 'Thing two'
        Label:

<CalibrationFrameWidget>:
    cFrameWidgetSpace:cFrameWidgetSpace
    cols: 1
    size: root.size
    pos:  root.pos
    GridLayout:
        rows: 2
        width: root.width
        height: root.height
        id: cFrameWidgetSpace
        GridLayout:
            cols: 3
            size_hint_y: .1
            Button:
                text: "Back"
                on_release: root.back()
            Button:
                text: "Skip"
                on_release: root.loadNextStep()
            Button:
                text: "Quit"
                on_release: root.on_Exit()

<SetChainLengthsFrameWidget>:
    cFrameWidgetSpace:cFrameWidgetSpace
    cols: 1
    size: root.size
    pos:  root.pos
    GridLayout:
        rows: 2
        width: root.width
        height: root.height
        id: cFrameWidgetSpace
        GridLayout:
            cols: 3
            size_hint_y: .1
            Button:
                text: "Back"
                on_release: root.back()
            Button:
                text: "Skip"
                on_release: root.loadNextStep()
            Button:
                text: "Quit"
                on_release: root.on_Exit()

<Intro>:
    cols: 2
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        size_hint_x: leftCol
        Label:
            text: 'This walk-through will guide you through the process of calibrating your Maslow Machine. \n\nYou can move forward and backwards through the walk-through at any time using the Back and Skip buttons\n\nYou can also skip this process entirely and enter your machine dimensions in the Settings window\n\nYour feedback on how to improve this process is more than welcome\n\nClick Begin to start. '
            color:(0, 0, 0, 1)
            text_size: self.size
            valign: 'middle'
    GridLayout:
        cols: 1
        size_hint_x: rightCol
        Label:
        Label:
            text: 'The controls you will need for each step will be on here on the right'
            text_size: self.size
        Button:
            text: "Begin"
            on_release: root.finished()
            background_color: (0, 1, 0, .6)
        Label:

<ChooseKinematicsType>:
    cols: 2
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        size_hint_x: leftCol
        Label:
            text: "Now we're going to select the way the chains attach to the sled. There are currently two options. \n\nThe \"Quadrilateral\" system attaches the chains to the two stationary metal L brackets as shown in the left picture.\nThis is currently the default option. \n\nThe \"Triangular\" system attaches the chains to a system of either linkages or bearings which let the ends of the chains\nrotate around the router bit as shown in the picture on the right.\n\n Please choose an option on the right."
            size_hint_x: leftCol
            text_size: self.size
            valign: 'middle'
        GridLayout:
            cols: 2
            Image:
                source: "./images/quadrilateral_kinematics.jpg"
            Image:
                source: "./images/triangular_kinematics.jpg"
    GridLayout:
        cols: 1
        size_hint_x: rightCol
        Label:
        Button:
            text: 'Quadrilateral'
            on_release: root.setKinematicsTypeQuad()
        Button:
            text: 'Triangular'
            on_release: root.setKinematicsTypeTri()
        Label:

<ChooseChainOverSprocketDirection>:
    cols: 2
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        size_hint_x: leftCol
        Label:
            text: "Now we're going to select the direction in which the chains pass over the sprocket.\n\nDo your chains come from the top of the sprocket and connect to the sled as shown in the picture on the left\nor come from the bottom of the sprocket to connect to the machine as shown in the picture on the right?"
            size_hint_x: leftCol
            text_size: self.size
            valign: 'middle'
        GridLayout:
            cols: 2
            Image:
                source: "./images/chainofftop.jpg"
            Image:
                source: "./images/chainoffbottom.jpg"
    GridLayout:
        cols: 1
        size_hint_x: rightCol
        Label:
        Button:
            text: 'Top'
            on_release: root.setChainToTop()
        Button:
            text: 'Bottom'
            on_release: root.setChainToBottom()
        Label:

<ComputeCalibrationSteps>
    cols: 1
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        size_hint_x: leftCol
        Label:
            text: "The correct calibration procedure for your machine is being generated...please wait"
            size_hint_x: leftCol
            text_size: self.size
            valign: 'middle'
    GridLayout:
        cols: 1

<RemoveChains>:
    cols: 2
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        size_hint_x: leftCol
        Label:
            text: 'Now we need to remove the chains from the machine so that we can put them back on\nin the correct direction for your bottom feeding configuration.\n\nRemove the chain from the sprocket, then click [Next]'
            text_size: self.size
            valign: 'middle'
    GridLayout:
        cols: 1
        size_hint_x: rightCol
        Label:
        Button:
            text: "Next"
            on_release: root.loadNextStep()
        Label:

<ReviewMeasurements>:
    padding: 20
    cols: 2
    width: root.width
    height: root.height
    measurementsReadout:measurementsReadout
    GridLayout:
        padding: 20
        cols: 1
        rows:2
        size_hint_x: leftCol
        Label:
            text: ""
            markup: True
            size_hint_x: leftCol
            id: measurementsReadout
            text_size: self.size
            valign: 'middle'
        Label:
            text: ""

    GridLayout:
        cols: 1
        padding: 20
        size_hint_x: rightCol
        Label:
        Button:
            text: "Looks Good!"
            on_release: root.loadNextStep()
            background_color: (0, 1, 0, .6)
        Label:

<TriangularCalibration>:
    cutBtnT:cutBtnT
    horzMeasureT1:horzMeasureT1
    horzMeasureT2:horzMeasureT2
    vertMeasureT1:vertMeasureT1
    bitDiameterT:bitDiameterT
    enterValuesT:enterValuesT
    unitsBtnT:unitsBtnT

    cols: 2
    padding: 20
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        Image:
            source: "./images/step_5.gif"
            pos_hint: {'left':1, 'top':1}
            size_hint: None, None
            allow_stretch: False
            keep_ratio: True
        Label:
            text: "[b][color=0d72e6]TO REFINE THE CALIBRATION WE ARE GOING TO MAKE 5 TEST CUTS AND TAKE 3 MEASUREMENTS.[/color][/b]\n\n  [color=000]1 - Enter the bit diameter will be used to make the cuts (1/4\" = 6.35 mm) [Bit Diameter]\n  2 - Be sure the machine is ready to cut, start the router and click on [Cut Test Pattern] to begin\n[b][color=f89405]       Wait for the mechine to finish the cuts...[/color][/b]\n\n  3 - Measure from the left edge of cut 1 to the left edge of cut 2.\n  4 - Measure from the left edge of cut 3 to the left edge of cut 4.\n  5 - Measure from the top edge of the work area to the top edge of cut 5\n[b][color=f89405]       The more accurate your measurements are, the more cucurate your machine will be.[/color][/b]\n  6 - Click [Enter Values] when done.[/color]"
            markup: True
            text_size: self.size
            valign: 'top'
        GridLayout:
            cols: 2
            Image:
                source: "./images/triangular_cuts.png"
                size_hint_x: 0.5
            Label:
                text: root.triangularCalText
                size_hint_x: 0.5
    GridLayout:
        cols: 1
        padding: 20
        size_hint_x: rightCol
        Label:
            text: "Measurements\nBetween Cuts 1 and 2"
            color:(0, 0, 0, 1)
            halign: "center"
        TextInput:
            id: horzMeasureT1
            disabled: True
        Label:
            text: "\nBetween Cuts 3 and 4"
            color:(0, 0, 0, 1)
            halign: "center"
        TextInput:
            id: horzMeasureT2
            disabled: True
        Label:
            text: "\nWork Area Top to Cut 5"
            color:(0, 0, 0, 1)
            halign: "center"
        TextInput:
            id: vertMeasureT1
            disabled: True
        Label:
            text: "Bit Diameter:"
            color:(0, 0, 0, 1)
            halign: "center"
        TextInput:
            id: bitDiameterT
            disabled: False
        Button:
            text: "Units: mm"
            on_release: root.switchUnitsT()
            background_color: (0, 1.2, 2.4, 0.7)
            id: unitsBtnT
            disabled: False
        Button:
            text: "Enter Values"
            halign: "center"
            on_release: root.enterTestPaternValuesTriangular()
            background_color: (0, 1.2, 2.4, 0.7)
            id: enterValuesT
            disabled: True
        Button:
            text: "Cut Test\nPattern"
            halign: "center"
            id: cutBtnT
            on_release: root.cutTestPaternTriangular()
            background_color: (0, 1.2, 2.4, 0.7)
        Button:
            text: "Stop\nCut"
            halign: "center"
            on_release: root.stopCut()
            background_color: (2.5, 0.5, 1.0, 0.7)
            size_hint: (0.5,1.5)
        Label:

<ComputeChainCorrectionFactors>:
    selfText:selfText

    cols: 2
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        size_hint_x: leftCol
        Label:
            text: "placeholder text"
            id: selfText
            text_size: self.size
            valign: 'middle'
    GridLayout:
        cols: 1
        size_hint_x: rightCol
        Label:
        Button:
            text: "Looks\nGood"
            halign: "center"
            on_release: root.loadNextStep()
            id: enterValues
        Label:

<EnterDistanceBetweenMotors>:
    motorsDist:motorsDist
    unitsBtnT:unitsBtn
    cols: 2
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        padding: 20
        Image:
            source: "./images/step_2.gif"
            pos_hint: {'left':1, 'top':1}
            size_hint: None, None
            allow_stretch: False
            keep_ratio: True
        Label:
            size_hint_x: leftCol
            text: "[b][color=0d72e6]MEASURE THE DISTANCE FROM THE OUTSIDE EDGE OF ONE MOTOR TO THE OUTSIDE EDGE OF THE OTHER MOTOR.[/color][/b]\n\n[color=000000]NOTE: On the final step (values review), the distance entered here will have 40.4mm deducted automaticly to reflect the center shaft to center shaft distance.[/color]"
            markup: True
            size_hint_x: leftCol
            text_size: self.size
            valign: 'top'
        GridLayout:
            cols: 1
            size_hint_y: 2.5
            Image:
                source: "./images/top_measure.gif"

    GridLayout:
        cols: 1
        padding: 20
        size_hint_x: rightCol
        Label:
        Label:
            text: "Distance Between Motors:"
            color: (0, 0, 0, 1)
            halign: "center"
        TextInput:
            size_hint: (.2, None)
            height: 40
            multiline: False
            id: motorsDist
        Label:
            text: "Select Units:"
            color: (0, 0, 0, 1)
        Button:
            size_hint: (.2, None)
            height: 60
            text: "mm"
            on_release: root.switchUnits()
            background_color: (0, 1.2, 2.4, 0.7)
            id: unitsBtn
        Label:
            text: ""
        Button:
            size_hint: (.2, None)
            height: 100
            text: "Enter Values"
            halign: "center"
            on_release: root.enterValues()
            background_color: (0, 1, 0, .6)
            id: enterValues
        Label:
        Label:
        Label:

<WipeOldCorrectionValues>:
    cols: 2
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        size_hint_x: leftCol
        Label:
            text: "\n\n\n\n[b][color=0d72e6]We need to wipe any existing values for the chain correction values before computing new ones.[/color][/b]\n\n[color=000000]This step will set the values to 0 [/color]"
            markup: True
            text_size: self.size
            valign: 'top'
    GridLayout:
        cols: 1
        size_hint_x: rightCol
        Label:
        Button:
            text: "Wipe Current\nValues"
            halign: "center"
            on_release: root.wipeOldSettings()
            background_color: (0, 1, 0, .6)
            id: enterValues
        Label:

<ManualCalibration>:
    motorsDist:motorsDist
    rotationRadius:rotationRadius
    vertMeasure:vertMeasure
    enterValuesT:enterValues
    unitsBtnT:unitsBtn
    chooseFeedDir:chooseFeedDir
    chooseKinematics:chooseKinematics

    cols: 2
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        rows: 3
        size_hint_x: leftCol
        Label:
            text: "[b][color=0d72e6]  This option lets you enter the dimensions of your machine manually which can be faster and easier than the automatic calibration process,\n\r but the results might be less accurate. [/color][/b]"
            markup: True
            text_size: self.size
            valign: 'middle'
        Label:
            text: ""
            text_size: self.size
        Label:
            text: ""
            text_size: self.size
    GridLayout:
        cols: 1
        padding: 10
        size_hint_x: rightCol
        Label:
        Label:
            text: "Distance\nBetween Motors:"
            color: (0,0,0,1)
            halign: "center"
        TextInput:
            id: motorsDist
        Label:
            text: "Rotation Radius:"
            color: (0,0,0,1)
            halign: "center"
        TextInput:
            id: rotationRadius
        Label:
            text: "Distance from\ntop of workspace to motors:"
            color: (0,0,0,1)
            halign: "center"
        TextInput:
            id: vertMeasure
        Button:
            text: "Units: mm"
            on_release: root.switchUnits()
            id: unitsBtn
        Label:
            text: "Kinematics type:"
            color: (0,0,0,1)
            halign: "center"
        Spinner:
            id: chooseKinematics
            text: "Triangular"
            values: ["Triangular", "Quadrilateral"]
        Label:
            text: "Chain Feed:"
            color: (0,0,0,1)
            halign: "center"
        Spinner:
            id: chooseFeedDir
            text: "Top"
            values: ["Top", "Bottom"]
        Button:
            text: "Enter Values"
            halign: "center"
            on_release: root.enterValues()
            id: enterValues
        Label:

<QuadTestCut>
    cutBtn:cutBtn
    enterValues:enterValues
    horizMeasure:horizMeasure
    vertMeasure:vertMeasure
    unitsBtn:unitsBtn
    enterValues:enterValues
    cols: 2
    GridLayout:
        cols: 1
        size_hint_x: leftCol
        Label:
            text: "To refine these measurements we're going to cut a test shape.\n\nThe test shape consists of two short horizontal cuts and two short vertical cuts\n\nBased on the distance between these marks we can dial in the machine settings\n\nThe size of bit used is not critical\nMeasure to any point on the mark as long as you are consistent\n\nThe process will repeat until both measurements are equal to within .5mm\nThe more accurate your measurements, the more accurate your machine will be\n\nPress Cut Test Pattern to begin"
            text_size: self.size
            valign: 'middle'
        GridLayout:
            cols: 3
            Image:
                source: "./images/testshapepreview.jpg"
            Image:
                source: "./images/measuretestshapehorizontal.jpg"
            Image:
                source: "./images/measuretestshapevertical.jpg"
    GridLayout:
        cols: 1
        size_hint_x: rightCol
        Label:
        Label:
            text: "Horizontal\nMeasurement:"
        TextInput:
            id:horizMeasure
            disabled: True
        Label:
            text: "Vertical\nMeasurement:"
        TextInput:
            id: vertMeasure
            disabled: True
        Button:
            text: "MM"
            on_release: root.switchUnits()
            id: unitsBtn
            disabled: True
        Button:
            text: "Enter Values"
            on_release: root.enterTestPaternValues()
            id: enterValues
            disabled: True
        Button:
            text: "Cut Test\nPattern"
            id: cutBtn
            on_release: root.cutTestPatern()
        Button:
            text: "Stop\nCut"
            on_release: root.stopCut()
            background_color: (2.5, 0.5, 1.0, 0.7)
        Label:

<MeasureDistBetweenMotors>
    distToMove:distToMove
    distText:distText
    cols: 2
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        padding: 20
        Image:
            source: "./images/step_2.gif"
            pos_hint: {'left':1, 'top':1}
            size_hint: None, None
            allow_stretch: False
            keep_ratio: True
        Label:
            text: "[color=02cafc]  WE ARE GOING TO USE THE CHAIN TO MEASURE THE DISTANCE BETWEEN THE MOTORS.[/color]\n\n• Hook the first link from the left chain over the top tooth on the left motor as shown in the picture below,\n  then use the 'Extend' button repeatedly to extend the chain until it can reach the right motor.\n  [b][color=f89405]Hint. you can use the distance button to set the length of chain moved for each Extend/Retract action.[/color][/b]\n\n• Once the chain has enough slack to reach the right motor, hook the third link on the right motor's 12:00 tooth as shown in the picture below.\n  Use the 'Retract' button to take out sufficient slack to make the chain nearly tight.\n  [b][color=f89405]Hint - update the distance value to move the chain a short distance to remove most but not all of the slack.[/color][/b]\n\n• Finally, use the 'Pull Chain Tight and Measure' button to then pull the chain tight and take a measurement.\n\n  Make sure the chains do not get tangled around the sprocket. The motors are very powerful and the machine can damage itself this way."
            markup: True
            size_hint_x: leftCol
            text_size: self.size
            valign: 'top'
        GridLayout:
            cols: 3
            Image:
                source: "./images/ChainOnLeftSprocket.jpg"
            Image:
                source: "./images/ChainBetweenSprockets.jpg"
            Image:
                source: "./images/ChainOnRightSprocket.jpg"
    GridLayout:
        cols: 1
        padding: 20
        size_hint_x: rightCol
        Label:
        Label:
            text: "Dist(MM):"
            id: distText
        Button:
            text: "100"
            on_release: root.textInputPopup(self)
            background_color: (0, 1.2, 2.4, 0.7)
            id: distToMove
        Button:
            text: "Extend"
            on_release: root.extend()
            background_color: (0, 1.2, 2.4, 0.7)
        Button:
            text: "Retract"
            on_release: root.retract()
            background_color: (0, 1.2, 2.4, 0.7)
        Button:
            text: 'Pull Chain Tight\nand Measure'
            on_release: root.pullChainTightAndMeasure()
            background_color: (0, 1.2, 2.4, 0.7)
        Button:
            text: "Stop\nMotors"
            on_release: root.stopCut()
            background_color: (2.5, 0.5, 1.0, 0.7)
        Label:

<MeasureOneChain>
    cols: 2
    width: root.width
    height: root.height
    mainText:mainText
    GridLayout:
        cols: 1
        Label:
            text: " "
            size_hint_x: leftCol
            id: mainText
            text_size: self.size
            valign: 'middle'
        GridLayout:
            cols: 3
            Image:
                source: "./images/ChainOnLeftSprocket.jpg"
            Image:
                source: "./images/ChainBetweenSprockets.jpg"
            Image:
                source: "./images/ChainOnRightSprocket.jpg"
    GridLayout:
        cols: 1
        size_hint_x: rightCol
        Label:
        Button:
            text: "Extend"
            on_release: root.extend()
        Button:
            text: 'Measure'
            on_release: root.measure()
        Button:
            text: "Stop\nMotors"
            on_release: root.stopCut()
            background_color: (2.5, 0.5, 1.0, 0.7)
        Label:

<VertDistToMotorsGuess>:
    enterMeasurement:enterMeasurement
    cols: 2
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        size_hint_x: leftCol
        Label:
            text: "Next we need to enter a rough measurement for how far the motors are above the top of the work area\n\nMeasure from the center of the motor shaft to the top of the sheet of plywood\n\nThis measurement is not critical for the accuracy of the machine, but will move the center position up and down."
            size_hint_x: leftCol
            text_size: self.size
            valign: 'middle'
        GridLayout:
            cols: 2
            Image:
                source: "./images/measuremotorheight.jpg"
    GridLayout:
        cols: 1
        size_hint_x: rightCol
        Label:
        Button:
            text: "Enter Measurement"
            id: enterMeasurement
            on_release: root.textInputPopup(self)
        Button:
            text: 'Next'
            on_release: root.enterValues()
        Label:

<AdjustZCalibrationDepth>:
    zAxisActiveSwitch:zAxisActiveSwitch
    openZPopupBtn:openZPopupBtn
    cols: 2
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        padding: 20
        Image:
            source: "./images/step_4.gif"
            pos_hint: {'left':1, 'top':1}
            size_hint: None, None
            allow_stretch: False
            keep_ratio: True
        Label:
            text: "[b][color=0d72e6]WE ARE GOING TO ZEROING THE Z-AXIS [/color][/b]\n\n[color=000000] 1 - Install a router bit and click on [ Adjust Z-Axis ] to begin.\n 2 - From the popup menu, use [lower] button until the bit barely touches the wood (router off), then press [Define Zero] and [Done].[/color]\n\n[b][color=f89405]HINT: The top/left button displays the distance in mm/in the axis will move each time you click on Rise/Lower button - adjust as needed.[/color][/b]"
            markup: True
            size_hint_x: leftCol
            text_size: self.size
            valign: 'top'
        GridLayout:
            cols: 2
            Image:
                source: "./images/set_zero.png"
    GridLayout:
        cols: 1
        padding: 20
        size_hint_x: rightCol
        Label:
        GridLayout:
            cols: 2
            Label:
                text: 'Enable\nAutomatic\nZ-Axis:'
                color: (0, 0, 0, 1)
                halign: "center"
            Switch:
                on_active: root.enableZaxis()
                id: zAxisActiveSwitch
        Button:
            text: "Adjust Z-Axis"
            on_release: root.zAxisPopup()
            background_color: (0, 1.2, 2.4, 0.7)
            disabled:True
            id: openZPopupBtn
        Button:
            text: 'Next'
            on_release: root.zeroZ()
            background_color: (0, 1, 0, .6)
        Label:

<RotationRadiusGuess>:
    enterMeasurement:enterMeasurement
    cols: 2
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        size_hint_x: leftCol
        Label:
            text: "Next we need to enter a rough estimate for the rotation radius.\nThis is the distance from the tip of the chain to the center of the router bit.\n\nFor the ring this distance is 140mm\nFor the wooden linkage kits it is around 260mm\nFor the metal linkage kits it is around 150mm\n\n*These numbers are rough and should be updated*"
            size_hint_x: leftCol
            text_size: self.size
            valign: 'middle'
    GridLayout:
        cols: 1
        size_hint_x: rightCol
        Label:
        Button:
            text: "Enter Measurement"
            id: enterMeasurement
            on_release: root.textInputPopup(self)
        Button:
            text: 'Next'
            on_release: root.enterValues()
        Label:

<DistBetweenChainBrackets>:
    enterMeasurement:enterMeasurement
    cols: 2
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        size_hint_x: leftCol
        Label:
            text: "Next we need to enter a rough estimate for the distance between the points where the chains attach to the sled.\n\nThis estimate will be refined by the calibration process in the next step."
            size_hint_x: leftCol
            text_size: self.size
            valign: 'middle'
    GridLayout:
        cols: 1
        size_hint_x: rightCol
        Label:
        Button:
            text: "Enter Measurement"
            id: enterMeasurement
            on_release: root.textInputPopup(self)
        Button:
            text: 'Next'
            on_release: root.enterValue()
        Label:

<SetSprocketsVertical>:
    #Set sprockets to 12 o'clock
    cols: 2
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        padding: 20
        Image:
            source: "./images/step_1.gif"
            pos_hint: {'left':1, 'top':1}
            size_hint: None, None
            allow_stretch: False
            keep_ratio: True
        Label:
            text: "[b][color=0d72e6]IT IS IMPORTANT TO START WITH THE SPROCKETS IN A KNOWN CONFIGURATION.[/color][/b]\n\n[color=000000]Orient each sprocket so that one tooth faces straight up in the 12:00 o'clock position. \nUse the buttons to the right to rotate each sprocket as needed.\nWhen you are ready, press [Set Zero] [/color]"
            markup: True
            size_hint_x: leftCol
            text_size: self.size
            valign: 'top'
        Image:
            source: "./images/sprocketat1200.jpg"
    GridLayout:
        cols:1
        padding: 20
        size_hint_x: .4
        GridLayout:
            cols: 4
            size_hint_x: .4
            Label:
                text: "Left Sprocket"
                color:(0, 0, 0, 1)
                font_size: '20sp'
            Label:
            Label:
            Label:
            Button:
                text: '360 deg CCW'
                on_release: root.LeftCCW360()
                background_color: (0, 1.2, 2.4, 0.7)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None
                font_size: self.width * 0.15
            Button:
                text: '5 deg CCW'
                on_release: root.LeftCCW5()
                background_color: (0, 1.2, 2.4, 0.7)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None
                font_size: self.width * 0.15
            Button:
                text: '1 deg CCW'
                on_release: root.LeftCCW()
                background_color: (0, 1.2, 2.4, 0.7)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None
                font_size: self.width * 0.15
            Button:
                text: '0.1 deg CCW'
                on_release: root.LeftCCWpoint1()
                background_color: (0, 1.2, 2.4, 0.7)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None
                font_size: self.width * 0.15
            Button:
                text: '360 deg CW'
                on_release: root.LeftCW360()
                background_color: (0, 1.2, 2.4, 0.7)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None
                font_size: self.width * 0.15
            Button:
                text: '5 deg CW'
                on_release: root.LeftCW5()
                background_color: (0, 1.2, 2.4, 0.7)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None
                font_size: self.width * 0.15
            Button:
                text: '1 deg CW'
                on_release: root.LeftCW()
                background_color: (0, 1.2, 2.4, 0.7)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None
                font_size: self.width * 0.15
            Button:
                text: '0.1 deg CW'
                on_release: root.LeftCWpoint1()
                background_color: (0, 1.2, 2.4, 0.7)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None
                font_size: self.width * 0.15
            Label:
                text: "Right Sprocket"
                color:(0, 0, 0, 1)
                font_size: '20sp'
            Label:
            Label:
            Label:
            Button:
                text: '360 deg CCW'
                on_release: root.RightCCW360()
                background_color: (0, 1.2, 2.4, 0.7)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None
                font_size: self.width * 0.15
            Button:
                text: '5 deg CCW'
                on_release: root.RightCCW5()
                background_color: (0, 1.2, 2.4, 0.7)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None
                font_size: self.width * 0.15
            Button:
                text: '1 deg CCW'
                on_release: root.RightCCW()
                background_color: (0, 1.2, 2.4, 0.7)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None
                font_size: self.width * 0.15
            Button:
                text: '0.1 deg CCW'
                on_release: root.RightCCWpoint1()
                background_color: (0, 1.2, 2.4, 0.7)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None
                font_size: self.width * 0.15
            Button:
                text: '360 deg CW'
                on_release: root.RightCW360()
                background_color: (0, 1.2, 2.4, 0.7)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None
                font_size: self.width * 0.15
            Button:
                text: '5 deg CW'
                on_release: root.RightCW5()
                background_color: (0, 1.2, 2.4, 0.7)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None
                font_size: self.width * 0.15
            Button:
                text: '1 deg CW'
                on_release: root.RightCW()
                background_color: (0, 1.2, 2.4, 0.7)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None
                font_size: self.width * 0.15
            Button:
                text: '0.1 deg CW'
                on_release: root.RightCWpoint1()
                background_color: (0, 1.2, 2.4, 0.7)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None
                font_size: self.width * 0.15
            Label:
            Label:
            Label:
            Label:
            Button:
                text: "Automatic"
                on_release: root.setVerticalAutomatic()
                background_color: (0, 1.2, 2.4, 0.7)
                halign: 'center'
                valign: 'middle'
                text_size: self.width, None
                font_size: self.width * 0.15
        GridLayout:
            cols: 1
            size_hint_x: .4
            Label:
            Button:
                text: 'Set Zero'
                on_release: root.setZero()
                background_color: (0, 1, 0, .6)
            Label:

<MeasureOutChains>:
    leftChainBtn:leftChainBtn
    rightChainBtn:rightChainBtn
    leftImg:leftImg
    cols: 2
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        padding: 20
        Image:
            source: "./images/step_3.gif"
            pos_hint: {'left':1, 'top':1}
            size_hint: None, None
            allow_stretch: False
            keep_ratio: True
        Label:
            text: root.text
            markup: True
            size_hint_x: leftCol
            text_size: self.size
            valign: 'top'
        GridLayout:
            cols: 1
            size_hint_y: 1.5
            Image:
                id: leftImg

    GridLayout:
        cols: 1
        padding: 20
        size_hint_x: rightCol
        Label:
        Button:
            text: '   Adjust\nLeft Chain'
            on_release: root.startCountDownL()
            background_color: (0, 1.2, 2.4, 0.7)
            id: leftChainBtn
        Button:
            text: '   Adjust\nRight Chain'
            on_release: root.startCountDownR()
            background_color: (0, 1.2, 2.4, 0.7)
            id: rightChainBtn
        Button:
            text: 'Stop'
            on_release: root.stop()
            background_color: (2.5, 0.5, 1.0, 0.7)
        Button:
            text: 'Move to Center'
            on_release: root.moveToCenter()
            background_color: (0, 1.2, 2.4, 0.7)
        Button:
            text: 'Next'
            on_release: root.next()
            background_color: (0, 1, 0, .6)
        Label:

<Finish>:
    cols: 2
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        size_hint_x: leftCol
        Label:
            text: "Congratulations! Your calibration is complete."
            size_hint_x: leftCol
            text_size: self.size
            valign: 'middle'
    GridLayout:
        cols: 1
        size_hint_x: rightCol
        Label:
        Button:
            text: "Finish"
            on_release: root.closePopup()
            background_color: (0, 1, 0, .6)
        Label:

<FinishSetChainLengths>:
    cols: 2
    width: root.width
    height: root.height
    GridLayout:
        cols: 1
        size_hint_x: leftCol
        Label:
            text: "Congratulations! Your chains have been set to a known length."
            size_hint_x: leftCol
            text_size: self.size
            valign: 'middle'
    GridLayout:
        cols: 1
        size_hint_x: rightCol
        Label:
        Button:
            text: "Finish"
            on_release: root.closePopup()
        Label:

            cols: 2
            Label:
                text: "Your machine is now calibrated!\n\nCongratulations! "
                size_hint_x: leftCol
                id: finishText
            Button:
                text: 'Finish'
                on_release: root.done()
                background_color: (0, 1, 0, .6)
                size_hint_x: rightCol

<CalibrateLengthsPopup>:
    carousel:carousel
    setSprocketsVertical:setSprocketsVertical
    measureOutChains:measureOutChains

    cols: 1
    size: root.size
    pos: root.pos

    Carousel:
        id: carousel
        direction: "right"
        #:set leftCol .8
        #:set rightCol .2
        GridLayout:
            cols: 1
            SetSprocketsVertical:
                id: setSprocketsVertical
        GridLayout:
            cols: 1
            MeasureOutChains:
                id: measureOutChains
        #finish
        GridLayout:
            cols: 2
            width: root.width
            height: root.height
            GridLayout:
                cols: 1
                Label:
                    text: "The machine now has an accurate reading of the lengths of the chains.\n\nPress finish to close the popup"
                    size_hint_x: leftCol
            GridLayout:
                cols: 1
                size_hint_x: rightCol
                Label:
                Button:
                    text: 'Finish'
                    on_release: root.done()
                Label:

#simulation widgets

<simulationCanvas>:
    motorSpacingError:motorSpacingError
    motorVerticalError:motorVerticalError
    sledMountSpacingError:sledMountSpacingError
    scatterInstance:scatterInstance
    vertBitDist:vertBitDist
    vertCGDist:vertCGDist
    leftChainOffset:leftChainOffset
    rightChainOffset:rightChainOffset
    motorSpacingErrorLabel:motorSpacingErrorLabel
    motorVerticalErrorLabel:motorVerticalErrorLabel
    sledMountSpacingErrorLabel:sledMountSpacingErrorLabel
    vertBitDistLabel:vertBitDistLabel
    vertCGDistLabel:vertCGDistLabel
    leftChainOffsetLabel:leftChainOffsetLabel
    rightChainOffsetLabel:rightChainOffsetLabel
    machineLabel1:machineLabel1
    machineLabel2:machineLabel2
    gridSize:gridSize
    gridSizeLabel:gridSizeLabel
    rotationRadiusOffset:rotationRadiusOffset
    rotationRadiusLabel:rotationRadiusLabel
    chainSagCorrectionOffset:chainSagCorrectionOffset
    chainSagCorrectionLabel:chainSagCorrectionLabel
    kinematicsSelect:kinematicsSelect

    rows: 3
    Label:
        text: "This simulation is designed to help us understand how the math behind Maslow is affected by errors in the computed machine dimensions\nTry adding error to any measurement, then press Recompute to see the effect\nThe path computed with the correct values is shown in green, the path with error added is shown in red"
        color: (0,0,0,1)
        size_hint_y:.22
    GridLayout:
        cols: 2
        size_hint_y: .1
        Label:
            text: "Not yet computed"
            color: (0,0,0,1)
            id: machineLabel1
            font_size: sp(10)
        Label:
            text: "Not yet computed"
            color: (0,0,0,1)
            id: machineLabel2
            font_size: sp(10)
    GridLayout:
        cols: 2
        size_hint_y: .9
        ScatterPlane:
            do_rotation: False
            id: scatterInstance
            size_hint_x: .9

        GridLayout:
            canvas.before:
                Color:
                    rgba: .32, .32, .32, 1
                Rectangle:
                    pos:self.pos
                    size:self.size
            cols: 1
            size_hint_x: .1
            padding: 10
            Spinner:
                id: kinematicsSelect
                text: "Kinematics Type"
                values: "Quadrilateral", "Triangular"
                on_text: root.setKinematics(kinematicsSelect.text)
            Label:
                text: "Motor Spacing\nError: 0mm"
                text_size: self.width, self.height
                font_size: sp(self.height)/sp(3)
                id: motorSpacingErrorLabel
            Slider:
                min: -50
                max:50
                value: 0
                id: motorSpacingError
            Label:
                text: "Motor Vertical\nError: 0mm"
                text_size: self.width, self.height
                font_size: sp(self.height)/sp(3)
                id: motorVerticalErrorLabel
            Slider:
                min: -50
                max:50
                value: 0
                id: motorVerticalError
            Label:
                text: "Sled Mount\nSpacing Error: 0mm"
                text_size: self.width, self.height
                font_size: sp(self.height)/sp(3)
                id: sledMountSpacingErrorLabel
                disabled: not root.isQuadKinematics
            Slider:
                min: -50
                max:50
                value: 0
                id: sledMountSpacingError
                disabled: not root.isQuadKinematics
            Label:
                text: "Vert Dist To\nBit Error: 0mm"
                text_size: self.width, self.height
                font_size: sp(self.height)/sp(3)
                id: vertBitDistLabel
                disabled: not root.isQuadKinematics
            Slider:
                min: -50
                max:50
                value: 0
                id: vertBitDist
                disabled: not root.isQuadKinematics
            Label:
                text: "Vert Dist\nBit to CG Error: 0mm"
                text_size: self.width, self.height
                font_size: sp(self.height)/sp(3)
                disabled: not root.isQuadKinematics
                id: vertCGDistLabel
            Slider:
                min: -50
                max:50
                value: 0
                id: vertCGDist
                disabled: not root.isQuadKinematics
            Label:
                text: "Left Chain\nSlipped Links: 0links"
                text_size: self.width, self.height
                font_size: sp(self.height)/sp(3)
                id: leftChainOffsetLabel
            Slider:
                min: -10
                max:10
                value: 0
                id: leftChainOffset
            Label:
                text: "Right Chain\nSlipped Links: 0links"
                text_size: self.width, self.height
                font_size: sp(self.height)/sp(3)
                id: rightChainOffsetLabel
            Slider:
                min: -10
                max:10
                value: 0
                id: rightChainOffset
            Label:
                text: "Rotation Radius"
                text_size: self.width, self.height
                font_size: sp(self.height)/sp(3)
                disabled: root.isQuadKinematics
                id: rotationRadiusLabel
            Slider:
                min: -25
                max:25
                value: 0
                disabled: root.isQuadKinematics
                id: rotationRadiusOffset
            Label:
                text: "Chain Sag Correction"
                text_size: self.width, self.height
                font_size: sp(self.height)/sp(3)
                disabled: root.isQuadKinematics
                id: chainSagCorrectionLabel
            Slider:
                min: -50
                max:50
                value: 0
                disabled: root.isQuadKinematics
                id: chainSagCorrectionOffset
            Label:
                text: "Grid Size: 150mm"
                text_size: self.width, self.height
                font_size: sp(self.height)/sp(3)
                id: gridSizeLabel
            Slider:
                min: 25
                max:300
                value: 300
                id: gridSize

            Button:
                text: "Reset All"
                on_release: root.resetSliders()
            Button:
                text: "Recompute"
                on_release: root.recompute()

<BackgroundMenu>:
    cols:1
    size: root.size
    pos: root.pos
    Button:
        text: 'Open Background'
        on_release: root.openBackground()
	Button:
		text: 'Re-pick Alignment'
		on_release: root.realignBackground()
		disabled: app.data.backgroundTexture is None
    Button:
        text: 'Update Background'
        on_release: root.reloadBackground()
    Button:
        text: 'Remove Background'
        on_release: root.clear_background()
    Button:
        text: 'Close'
        on_press: app.frontpage.gcodecanvas.centerCanvas() #Force canvas redraw
        on_release: root.close()

<BackgroundPickDlg>
    imWidg:imWidg
    cols: 1
    size: root.size
	pos: root.pos
	GridLayout:
		cols: 4
        Button:
            size_hint_x: None
			size_hint: 0.5, 1
            text: 'Reset Image'
            on_release: root.reset_image()
        Label:
            size_hint_x: None
			size_hint: 2.5, 1
			text_size: self.width, self.height
			font_size: sp(self.height)/sp(5)
            halign: 'center'
			valign: 'middle'
            text: root.instructionText
        Button:
            size_hint_x: None
			size_hint: 0.5, 1
            text: 'Resize Texture'
            on_release: root.resize_texture()
        Button:
            size_hint_x: None
			size_hint: 0.5, 1
            text: 'Accept'
            on_press: app.frontpage.gcodecanvas.centerCanvas() #Force canvas redraw
            on_release: root.accept_texture()
    Widget:
        size_hint_y: None
        size_hint: 1, 7
        id: imWidg
        canvas:
            Color:
                rgba: (1, 1, 1, 1)
            Rectangle:
                texture: root.texture
                pos: self.pos
    			size: self.size
                tex_coords: root.tex_coords
            Color:
                rgba: (1, 0, 0, 0.5)
            Line:
                points: root.tex_selection
                close: True
            Color:
                rgba: (0, 1, 1, 0.3)
            Line:
                circle: root.tex_selection[0], root.tex_selection[1], 10
            Line:
                circle: root.tex_selection[2], root.tex_selection[3], 10
            Line:
                circle: root.tex_selection[4], root.tex_selection[5], 10
            Line:
                circle: root.tex_selection[6], root.tex_selection[7], 10

<TestPoint>

#:import pi math.pi
#:import cos math.cos
#:import sin math.sin
#:import V kivy.vector.Vector
<ModernMenu>:
    canvas.before:
        Color:
            rgba: (0, 0, 0, 0)
        Ellipse:
            pos: self.center_x - self.radius, self.center_y - self.radius
            size: self.radius * 2, self.radius * 2
            angle_start: 0
            angle_end: self.circle_progress * 360 * self.creation_direction
        Color:
            rgba: self.color
        Line:
            circle:
                (
                self.center_x, self.center_y,
                self.radius, 0, self.circle_progress * 360 * self.creation_direction
                )
            width: self.line_width
    on_touch_down:
        V(args[1].pos).distance(self.center) < self.radius and (
        self.back() if self.choices_history else self.dismiss())

<ModernMenuLabel>:
    size: self.texture_size
    padding: 5, 5
    on_press: self.callback and self.callback(self)
    on_release: root.dismiss()
    canvas.before:
        Color:
            rgba: (0, 0, 0, 0)
        Rectangle:
            pos: self.pos
            size: self.size
        Line:
            points:
                (
                self.center_x, self.center_y,
                self.parent.center_x + cos(
                self.opacity * self.index * 2 * pi / self.siblings
                ) * self.parent.radius,
                self.parent.center_y + sin(
                self.opacity * self.index * 2 * pi / self.siblings
                ) * self.parent.radius
                ) if self.parent else []
            width: self.parent.line_width if self.parent else 1
    center:
        (
        self.parent.center_x +
        cos(self.opacity * self.index * 2 * pi / self.siblings) * self.radius,
        self.parent.center_y +
        sin(self.opacity * self.index * 2 * pi / self.siblings) * self.radius
        ) if (self.size and self.parent and self.parent.children) else (0, 0)
